<div class="d-flex flex-wrap align-items-center justify-content-between mb-3 gap-2">
  <h1 class="mb-0"><i class="bi bi-house-door"></i> My Dashboard</h1>
  <div class="d-flex align-items-center gap-2">
    <div class="card shadow-sm border-0" style="min-width: 240px;">
      <div class="card-body py-2 px-3">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center">
            <i class="bi bi-cloud-sun text-primary fs-4 me-2"></i>
            <div>
              <p class="mb-0 fw-semibold">Weather</p>
              <small class="text-muted"><%= weather ? (weather.city + (weather.country ? ', ' + weather.country : '')) : weatherCity %></small>
            </div>
          </div>
          <form class="d-flex" method="get" action="/dashboard" role="search">
            <input class="form-control form-control-sm" style="width: 120px;" type="search" name="city" placeholder="City" value="<%= weatherCity %>" />
            <button class="btn btn-sm btn-outline-primary ms-2" type="submit" title="Refresh"><i class="bi bi-arrow-repeat"></i></button>
          </form>
        </div>
        <div class="mt-2">
          <% if (weatherError) { %>
            <p class="text-warning small mb-0"><i class="bi bi-exclamation-triangle"></i> <%= weatherError %></p>
          <% } else if (weather) { %>
            <div class="d-flex align-items-center">
              <% if (weather.icon) { %>
                <img src="https://openweathermap.org/img/wn/<%= weather.icon %>@2x.png" alt="Weather icon" width="42" height="42" />
              <% } %>
              <div class="ms-2">
                <span class="fw-semibold"><%= weather.temperature %>&deg;C</span>
                <small class="text-muted ms-1">Feels <%= weather.feelsLike %>&deg;C</small><br>
                <small class="text-muted text-capitalize"><%= weather.description %></small>
              </div>
            </div>
          <% } else { %>
            <p class="text-muted small mb-0">Weather data loading...</p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
  <div class="col-md-6 mb-3">
    <div class="card stats-card">
      <div class="card-body">
        <h5 class="card-title text-muted">Total Orders</h5>
        <h2 class="text-primary"><%= stats.totalOrders %></h2>
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-3">
    <div class="card stats-card">
      <div class="card-body">
        <h5 class="card-title text-muted">Total Spent</h5>
        <h2 class="text-success">$<%= stats.totalSpent.toFixed(2) %></h2>
      </div>
    </div>
  </div>
</div>

<!-- Recent Orders -->
<div class="card">
  <div class="card-header bg-dark text-white">
    <h5 class="mb-0"><i class="bi bi-bag-check"></i> Recent Orders</h5>
  </div>
  <div class="card-body">
    <% if (stats.recentOrders.length === 0) { %>
      <p class="text-muted">You haven't placed any orders yet.</p>
      <a href="/sales/create" class="btn btn-primary">
        <i class="bi bi-cart-plus"></i> Place Your First Order
      </a>
    <% } else { %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Date</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% stats.recentOrders.forEach(order => { %>
              <tr>
                <td>#<%= order.sale_id %></td>
                <td><%= order.sale_date %></td>
                <td>$<%= parseFloat(order.total_amount || 0).toFixed(2) %></td>
                <td><span class="badge bg-success">Completed</span></td>
                <td>
                  <a href="/sales/<%= order.sale_id %>" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i> View Details
                  </a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <a href="/sales/my-orders" class="btn btn-primary">View All Orders</a>
    <% } %>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body text-center">
        <i class="bi bi-shop" style="font-size: 3rem; color: #6F4E37;"></i>
        <h5 class="mt-3">Browse Products</h5>
        <a href="/products" class="btn btn-primary">View Catalog</a>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
      <div class="card-body text-center">
        <i class="bi bi-cart-plus" style="font-size: 3rem; color: #6F4E37;"></i>
        <h5 class="mt-3">Place New Order</h5>
        <a href="/sales/create" class="btn btn-primary">Start Shopping</a>
      </div>
    </div>
  </div>
</div>