<div class="row">
  <div class="col-lg-8">
    <h2 class="mb-4">Place Your Order</h2>
    
    <form id="orderForm" action="/sales/create" method="POST">
      <div class="card mb-3">
        <div class="card-header">
          <h5>Select Products</h5>
        </div>
        <div class="card-body">
          <div id="cartItems">
            <!-- Dynamic items will be added here -->
          </div>
          
          <div class="mb-3">
            <label class="form-label">Add Product:</label>
            <div class="row g-2">
              <div class="col-md-6">
                <select class="form-select" id="productSelect">
                  <option value="">-- Select Product --</option>
                  <% products.forEach(p => { %>
                    <option value="<%= p.product_id %>" data-price="<%= p.unit_price %>" data-name="<%= p.product_name %>">
                      <%= p.product_name %> - $<%= p.unit_price %>
                    </option>
                  <% }) %>
                </select>
              </div>
              <div class="col-md-3">
                <input type="number" class="form-control" id="quantityInput" placeholder="Qty" min="1" value="1">
              </div>
              <div class="col-md-3">
                <button type="button" class="btn btn-primary w-100" id="addItemBtn">
                  <i class="bi bi-plus-circle"></i> Add
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <input type="hidden" name="items" id="itemsInput">
      <input type="hidden" name="discount_percentage" value="0">
      
      <button type="submit" class="btn btn-success btn-lg w-100" id="submitBtn" disabled>
        <i class="bi bi-check-circle"></i> Place Order
      </button>
    </form>
  </div>
  
  <div class="col-lg-4">
    <div class="card sticky-top" style="top: 20px;">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Order Summary</h5>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between mb-2">
          <span>Subtotal:</span>
          <strong id="subtotalDisplay">$0.00</strong>
        </div>
        <div class="d-flex justify-content-between mb-2">
          <span>Discount:</span>
          <strong id="discountDisplay">$0.00</strong>
        </div>
        <hr>
        <div class="d-flex justify-content-between">
          <span class="h5">Total:</span>
          <strong class="h5 text-success" id="totalDisplay">$0.00</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Client-side cart management
let cart = [];

document.getElementById('addItemBtn').addEventListener('click', function() {
  const select = document.getElementById('productSelect');
  const quantity = parseInt(document.getElementById('quantityInput').value);
  
  if (!select.value || quantity < 1) {
    alert('Please select a product and quantity');
    return;
  }

  const option = select.options[select.selectedIndex];
  const item = {
    product_id: parseInt(select.value),
    product_name: option.dataset.name,
    price: parseFloat(option.dataset.price),
    quantity: quantity
  };

  cart.push(item);
  updateCart();
  
  // Reset
  select.value = '';
  document.getElementById('quantityInput').value = 1;
});

function updateCart() {
  const container = document.getElementById('cartItems');
  const itemsInput = document.getElementById('itemsInput');
  
  if (cart.length === 0) {
    container.innerHTML = '<p class="text-muted">No items added yet</p>';
    document.getElementById('submitBtn').disabled = true;
    updateSummary();
    return;
  }

  container.innerHTML = cart.map((item, index) => `
    <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
      <div>
        <strong>${item.product_name}</strong><br>
        <small>$${item.price} Ã— ${item.quantity} = $${(item.price * item.quantity).toFixed(2)}</small>
      </div>
      <button type="button" class="btn btn-sm btn-danger" onclick="removeItem(${index})">
        <i class="bi bi-trash"></i>
      </button>
    </div>
  `).join('');

  // Update hidden input
  itemsInput.value = JSON.stringify(cart);
  document.getElementById('submitBtn').disabled = false;
  updateSummary();
}

function removeItem(index) {
  cart.splice(index, 1);
  updateCart();
}

function updateSummary() {
  const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const discount = 0; // You can add discount logic
  const total = subtotal - discount;

  document.getElementById('subtotalDisplay').textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById('discountDisplay').textContent = `$${discount.toFixed(2)}`;
  document.getElementById('totalDisplay').textContent = `$${total.toFixed(2)}`;
}
</script>